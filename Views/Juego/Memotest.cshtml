@{
    ViewData["Title"] = "Memotest";
    bool mostrarSeleccion = ViewBag.MostrarSeleccion == true;
    int? nivel = ViewBag.Nivel;

    var cartas = new string[0];
    var encontradas = new List<int>();

    if (!mostrarSeleccion && nivel.HasValue)
    {
        cartas = Context.Session.GetString("CartasMezcladas")?.Split(',') ?? new string[0];
        encontradas = Context.Session.GetString("Encontradas")?
            .Split(',', StringSplitOptions.RemoveEmptyEntries)
            .Select(int.Parse).ToList() ?? new List<int>();
    }
}

<header class="custom-header">
    <nav>
        <ul>
            <li>
                <a href="/Usuario/Perfil">
                    <img src="/img/header/perfil.png" alt="perfil">
                </a>
            </li>
            <li>
                <a href="/Usuario/Noti">
                    <img src="/img/header/noti.png" alt="notificaciones">
                </a>
            </li>
        </ul>

        <div class="menu-icon" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <div id="menu-overlay" class="menu-overlay" onclick="toggleMenu()"></div>

    <div id="sidebar-menu" class="menu-container sidebar-closed">
        <div class="menu-header">
            <button class="back-btn" onclick="toggleMenu()">←</button>
            <h1>MENÚ</h1>
        </div>

        <div class="menu-links">
            <a href="@Url.Action("Home", "Home")">Home</a>
            <a href="@Url.Action("Perfil", "Usuario")">Perfil</a>
            <a href="@Url.Action("Grupos", "Comunidades")">Grupos</a>
            <a href="@Url.Action("Index", "Tramite")">Tramites</a>
            <a href="@Url.Action("ChatBot", "ChatBot")">ChatBot</a>
            <a href="@Url.Action("Index", "Juego")">Juegos</a>
            <a href="@Url.Action("CerrarSesion", "Usuario")">Cerrar Sesión</a>
        </div>
    </div>
</header>

@if (mostrarSeleccion)
{
    <div class="memotest-container">
        <div class="memotest-content">
            <a href="@Url.Action("Index", "Juego")" class="volver-link">← Volver a juegos</a>
            <h2>Memotest</h2>
            <div class="instrucciones">
                <h3>¿Cómo jugar?</h3>
                <p>
                    El objetivo del juego es encontrar todos los pares de cartas.
                    Haz clic en dos cartas para voltearlas. Si coinciden, se quedarán descubiertas.
                    Si no coinciden, se darán vuelta nuevamente.
                </p>
            </div>

            <div class="niveles-seleccion">
                <h3>Selecciona un nivel:</h3>
                <div class="niveles-botones">
                    <a href="@Url.Action("Memotest", "Juego", new { nivel = 1 })" class="btn-nivel"><span>Nivel 1</span></a>
                    <a href="@Url.Action("Memotest", "Juego", new { nivel = 2 })" class="btn-nivel"><span>Nivel 2</span></a>
                    <a href="@Url.Action("Memotest", "Juego", new { nivel = 3 })" class="btn-nivel"><span>Nivel 3</span></a>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="memotest-container">
        <div class="memotest-content">
            <a href="@Url.Action("Memotest", "Juego")" class="volver-link">← Volver a niveles</a>
            <h2>Memotest - Nivel @nivel</h2>

            <div class="memotest-grid">
                @for (int i = 0; i < cartas.Length; i++)
                {
                    bool esEncontrada = encontradas.Contains(i);

                    <div class="carta @(esEncontrada ? "encontrada" : "")" data-index="@i">
                        <div class="inner">
                            <img class="cara frente" src="/img/memotest/@cartas[i]" alt="Carta" />
                            <img class="cara dorso" src="/img/memotest/dorso.png" alt="Dorso" />
                        </div>
                    </div>
                }
            </div>

        </div>
    </div>
}

<link rel="stylesheet" href="/css/memotest.css" />
@section Scripts {
    <script src="/js/memotest.js"></script>
}   